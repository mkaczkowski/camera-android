"use strict";var sioWebApp=angular.module("sioWebApp",["underscore","ngResource","ui.router","ionic","ngCordova.plugins.camera","ngCordova.plugins.dialogs","ngCordova.plugins.file","ngCordova.plugins.network","ngCordova.plugins.socialSharing","ngCordova.plugins.toast","hmTouchEvents","sioWebApp.config","sioWebApp.mock","sioWebApp.common","sioWebApp.navigation","sioWebApp.home"]);sioWebApp.config(["loggerProvider",function(a){a.enabled(!0)}]),sioWebApp.run(["$rootScope","configuration","$timeout","logger","_",function(a,b){a.app=b}]),angular.module("sioWebApp.config",[]).constant("configuration",{name:"SIO2 Backoffice",version:"SIO2 Backoffice v.1.0",copyright:"Ministerstwo Edukacji Narodowej, Szucha 25, Warszawa",marketUrl:"your.app.bundle.id",isProd:JSON.parse("true")}),angular.module("sioWebApp.home",[]),angular.module("sioWebApp.home").controller("HomeCtrl",["$scope","$ionicPopup","$ionicLoading","$timeout","imageService","cameraService","mySharedService","sharingService","notificationService","networkService","configuration",function(a,b,c,d,e,f,g,h,i,j,k){var l,m=function(){l=c.show({content:"Processing..."})},n=function(){l&&l.hide()};a.isEmpty=!0,a.isSelected=!1,a.$on("handleBroadcast",function(){a.isSelected=g.message,g.message&&(a.isEmpty=!1)}),a.resetElement=function(){console.log("resetElement"),g.resetElement()},a.removeElement=function(){console.log("remove Element"),g.removeElement(),a.isEmpty=0==angular.element(".drag-and-drop").length},a.moveUp=function(){console.log("up"),g.moveUp()},a.moveDown=function(){console.log("down"),g.moveDown()},a.hideToolbar=function(){a.isSelected=!1},a.saveCanvasToFile=function(a){m(),g.prepForBroadcast(null),d(function(){html2canvas([document.getElementById("draggableContainer")],{onrendered:function(b){e.saveCanvasToFile(b,function(b){n(),a?a(b):i.showInfo("Picture is saved!")},function(a){n(),console.log("saveCanvasToFile err:"+a),i.showError("Sorry, there was an error :(")})}})},2e3)},a.sharePicure=function(){a.saveCanvasToFile(function(a){h.shareViaFacebook(a)})},a.getPicture=function(){f.takePicture("pictureImg")},a.clearWhiteboard=function(){i.confirm("Are you sure you want to clear?",function(){g.clearAll(),a.isEmpty=!0})},a.rateUs=function(){j.openMarketURL(k.marketUrl)},g.init()}]),angular.module("sioWebApp.navigation",["sioWebApp.config"]),angular.module("sioWebApp.navigation").controller("NavigationCtrl",["$scope","$location",function(a,b){a.menuItems=[{name:"Home",path:"home"},{name:"Contact",path:"contact"}],a.isActive=function(a){return b.path().substr(0,a.length)==a}}]),angular.module("sioWebApp.common",[]),angular.module("sioWebApp.common").directive("debug",["$compile",function(a){return{terminal:!0,priority:1e6,link:function(b,c){var d=c.clone();c.attr("style","color:red"),d.removeAttr("debug");var e=a(d)(b);c.after(e)}}}]);var mySharedService=angular.module("sioWebApp.common").factory("mySharedService",["$rootScope",function(a){function b(a,b,d){var e;switch(a.type){case"touch":break;case"drag":d.posX=a.gesture.deltaX+d.lastPosX,d.posY=a.gesture.deltaY+d.lastPosY,e="translate("+d.posX+"px,"+d.posY+"px)",e+="rotate("+d.last_rotation+"deg) ",e+="scale("+d.last_scale+","+d.last_scale+")";break;case"transform":d.rotation=d.last_rotation+a.gesture.rotation,d.scale=Math.max(1,Math.min(d.last_scale*a.gesture.scale,10)),e="translate("+d.lastPosX+"px,"+d.lastPosY+"px) ",e+="rotate("+d.rotation+"deg) ",e+="scale("+d.scale+","+d.scale+")";break;case"transformend":d.last_scale=d.scale,d.last_rotation=d.rotation;break;case"dragend":d.lastPosX=d.posX,d.lastPosY=d.posY}c.applyTransform(b,e)}var c={},d={},e={posX:0,posY:0,lastPosX:0,lastPosY:0,bufferX:0,bufferY:0,scale:1,last_scale:1,rotation:0,last_rotation:0,dragReady:0},f={},g={};return c.init=function(){var a={transform_always_block:!0,transform_min_scale:1,drag_block_horizontal:!0,drag_block_vertical:!0,drag_min_distance:0};angular.element("#draggableContainer").hammer(a).on("tap",function(){alert("tap")}).on("touch drag dragend transform transformend",function(a){return angular.element(a.target).is("button")?!0:void(a.gesture&&(a.gesture.preventDefault(),"touch"==a.type&&(f=a.gesture.target.parentNode,g=c.getElement(f.className)),b(a,f,g)))})},c.applyTransform=function(a,b){console.info("trans:"+b),b&&(a.style.transform=b,a.style.oTransform=b,a.style.msTransform=b,a.style.mozTransform=b,a.style.webkitTransform=b)},c.addElement=function(a,b){function c(){for(var a="",b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",c=0;5>c;c++)a+=b.charAt(Math.floor(Math.random()*b.length));return a}a.first().css({top:b.top,left:b.left}),a.addClass(c()),d[a.get(0).className]=JSON.parse(JSON.stringify(e))},c.getElement=function(a){return d[a]},c.prepForBroadcast=function(a){this.message=a,this.broadcastItem()},c.broadcastItem=function(){a.$broadcast("handleBroadcast")},c.moveUp=function(){a.$broadcast("moveUp")},c.moveDown=function(){a.$broadcast("moveDown")},c.removeElement=function(){a.$broadcast("removeElement"),this.prepForBroadcast(null)},c.clearAll=function(){a.$broadcast("clearAll"),this.prepForBroadcast(null)},c.resetElement=function(){g=JSON.parse(JSON.stringify(e)),d[f.className]=g;var a="translate("+g.lastPosX+"px,"+g.lastPosY+"px) ";a+="rotate("+g.rotation+"deg) ",a+="scale("+g.scale+","+g.scale+")",c.applyTransform(f,a)},c.message,c}]);angular.module("sioWebApp.common").directive("draggableItem",["mySharedService",function(a){return{restrict:"E",templateUrl:"views/directives/draggable.html",replace:!0,piority:1e4,scope:{src:"@",top:"@",left:"@"},controller:["$scope","$element","mySharedService",function(a,b,c){a.isSelected=!0,c.prepForBroadcast(b),a.safeApply=function(a){var b=this.$root.$$phase;"$apply"==b||"$digest"==b?a&&"function"==typeof a&&a():this.$apply(a)}}],link:function(b,c){a.addElement(c,b),b.$on("handleBroadcast",function(){var e=a.message==c,f=e!=b.isSelected;b.isSelected=e,b.safeApply(),f&&d()}),b.$on("removeElement",function(){b.isSelected&&c.remove()}),b.$on("moveUp",function(){if(b.isSelected){var a=parseInt(c.css("zIndex"));console.log(a),c.css("zIndex",a+1)}}),b.$on("moveDown",function(){if(b.isSelected){var a=parseInt(c.css("zIndex"));if(console.log(a),0==a)return;c.css("zIndex",a-1)}}),b.$on("clearAll",function(){c.remove()});var d=function(){var a=angular.element(c.children()[0]);b.isSelected?a.addClass("selectedDraggable").css("border","3px dashed #545565"):a.removeClass("selectedDraggable").css("border","")};d(),c.bind("click touchstart",function(){a.prepForBroadcast(c)}),c.on("$destroy",function(){})}}}]),angular.module("sioWebApp.common").directive("carousel",["$compile","mySharedService",function(a){return{restrict:"E",replace:!0,transclude:!0,template:'<div class="myCarousel" style="width: 100%;" ng-transclude></div>',link:function(b,c){function d(a){var b="";for(var d in a.items){var f=a.items[d].width,g=a.items[d].height,h=a.items[d].img,i=".png",j=h+i;b+="<div ><img class='thumb-img' style='max-width: 100%' data-width='"+f+"' data-height='"+g+"' src='"+j+"' ></div>"}c.html(b),e()}function e(){angular.element(".thumb-img").bind("click",function(c){var d=angular.element(c.target),e=parseInt(d.attr("data-width")),f=parseInt(d.attr("data-height")),g=d.attr("src"),h=angular.element(document.getElementById("draggableContainer")),i=(h.height()-f)/2,j=(h.width()-e)/2,k=a('<draggable-item id="1" src="'+g+'" top="'+i+'px" left="'+j+'px"/>')(b);h.append(k)})}c.owlCarousel({jsonPath:"data/data.json",jsonSuccess:d,singleItem:!1,lazyLoad:!0,navigation:!0,pagination:!1,items:4})}}}]),angular.module("sioWebApp.common").provider("logger",[function(){var a=!0;this.enabled=function(b){a=!!b},this.$get=["$log",function(b){var c=function(a){this.context=a};return c.getInstance=function(a){return new c(a)},c.supplant=function(a,b){return a.replace(/\{([^{}]*)\}/g,function(a,c){var d=b[c];return"string"==typeof d||"number"==typeof d?d:a})},c.getFormattedTimestamp=function(a){return c.supplant("{0}:{1}:{2}:{3}",[a.getHours(),a.getMinutes(),a.getSeconds(),a.getMilliseconds()])},c.prototype={_log:function(d,e){if(a){var f=c.getFormattedTimestamp(new Date),g="",h=[];switch(e.length){case 1:g=c.supplant("{0} - {1}: {2}",[f,this.context,e[0]]);break;case 3:h=e[2],g=c.supplant("{0} - {1}::{2}('{3}')",[f,this.context,e[0],e[1]]);break;case 2:"string"==typeof e[1]?g=c.supplant("{0} - {1}::{2}('{3}')",[f,this.context,e[0],e[1]]):(h=e[1],g=c.supplant("{0} - {1}: {2}",[f,this.context,e[0]]))}b[d].call(null,c.supplant(g,h))}},log:function(){this._log("log",arguments)},info:function(){this._log("info",arguments)},warn:function(){this._log("warn",arguments)},debug:function(){this._log("debug",arguments)},error:function(){this._log("error",arguments)}},c}]}]),angular.module("sioWebApp.common").controller("FileCtrl",["$scope","$cordovaFile",function(a,b){a.api=function(){b.checkDir(directory).then(function(){},function(){}),b.createDir(directory,!1).then(function(){},function(){}),b.checkFile(directory,file).then(function(){},function(){}),b.createFile(directory,file,!0).then(function(){},function(){}),b.removeFile(directory,file).then(function(){},function(){}),b.writeFile(directory,file).then(function(){},function(){}),b.readFile(directory,file).then(function(){},function(){}),b.downloadFile(source,filePath,!0,options).then(function(){},function(){}),b.uploadFile(server,filePath,options).then(function(){},function(){})}}]),angular.module("sioWebApp.common").factory("networkService",["$cordovaNetwork",function(a){var b={};return b.isOnline=function(){return a.isOnline()},b.openMarketURL=function(a){cordova.market.open(a)},b}]),angular.module("sioWebApp.common").factory("imageService",function(){var a={};return a.saveCanvasToFile=function(a,b,c){return window.canvas2ImagePlugin?void window.canvas2ImagePlugin.saveImageDataToLibrary(b,c,a):void c()},a.setWallpaper=function(a,b,c){var d="christmas",e="PluginImages";a="www/img/christmas.jpeg",wallpaper.setImage(a,d,e,b,c)},a}),angular.module("sioWebApp.common").factory("notificationService",["$cordovaDialogs","$ionicPopup",function(a,b){var c={};return c.showError=function(a){var c=b.alert({title:a,okType:"button-assertive"});c.then(function(){console.log("showAlert closed.")})},c.showInfo=function(a){var c=b.alert({title:a,okType:"button-energized"});c.then(function(){console.log("showAlert closed.")})},c.confirm=function(a,c){return b.showPopup({title:a,content:"",buttons:[{text:"Cancel",type:"button-default",onTap:function(){return!0}},{text:"OK",type:"button-energized",onTap:function(){return c(),!0}}]})},c}]),angular.module("sioWebApp.common").factory("cameraService",["$cordovaCamera","notificationService",function(a,b){var c={};return c.options={quality:50,destinationType:Camera.DestinationType.DATA_URL,sourceType:Camera.PictureSourceType.CAMERA,allowEdit:!0,encodingType:Camera.EncodingType.JPEG,targetWidth:100,targetHeight:100,popoverOptions:CameraPopoverOptions,saveToPhotoAlbum:!1},c.getPicture2=function(d){a.getPicture(c.options).then(function(a){var b=document.getElementById(d);b.src="data:image/jpeg;base64,"+a},function(a){console.error("error!!:"+a),b.showError("Sorry, there was an error :(")})},c.takePicture=function(a){navigator.camera.getPicture(function(b){var c=document.getElementById(a);c.src="data:image/jpeg;base64,"+b},function(a){b.showError("Sorry, there was an error :("),console.error("error!!:"+a)},c.options)},c}]),angular.module("sioWebApp.common").factory("sharingService",["configuration","$cordovaSocialSharing","notificationService",function(a,b,c){var d={};return d.shareViaFacebook=function(d){var e=a.url,f="Magic Camera APP";b.shareViaFacebook(f,d,e).then(function(a){console.log("shareViaFacebook success! :"+a)},function(a){console.log("shareViaFacebook err:"+a),c.showError("Sorry, there was an error :(")})},d}]),angular.module("sioWebApp.mock",[]).run([function(){}]);